<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizza Crossing</title>
    <style>
        @font-face {
            font-family: 'PressStart2P';
            src: url('https://cdnjs.cloudflare.com/ajax/libs/webfont/1.6.28/webfontloader.js');
        }
        
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            touch-action: none;
            color: #fff;
        }
        
        #gameContainer {
            position: relative;
            width: 100%;
            max-width: 600px;
        }
        
        canvas {
            background-color: #333;
            display: block;
            width: 100%;
            max-width: 600px;
            max-height: 100vh;
        }
        
        #gameInfo {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 16px;
            z-index: 10;
        }
        
        #mobileControls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 40px;
            box-sizing: border-box;
            z-index: 10;
        }
        
        .mobileBtn {
            width: 60px;
            height: 60px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: white;
            user-select: none;
        }
        
        #musicToggle {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 30;
            font-size: 24px;
            display: none; /* Nascosto */
        }
        
        #startScreen, #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 20;
            text-shadow: 0.1em 0.1em #333;
        }
        
        .retro-text {
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 
                2px 2px 0px #ff0000,
                -2px -2px 0px #0000ff;
            animation: textFlicker 2s infinite alternate;
        }
        
        @keyframes textFlicker {
            0%, 19.999%, 22%, 62.999%, 64%, 64.999%, 70%, 100% {
                opacity: 1;
                text-shadow: 
                    2px 2px 0px #ff0000,
                    -2px -2px 0px #0000ff;
            }
            20%, 21.999%, 63%, 63.999%, 65%, 69.999% {
                opacity: 0.8;
                text-shadow: none;
            }
        }
        
        @keyframes scanlines {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 0 30px;
            }
        }
        
        .presents {
            font-size: 18px;
            color: #ffcc00;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .btn {
            background-color: #e74c3c;
            color: white;
            border: 5px solid #fff;
            border-style: outset;
            padding: 12px 24px;
            margin-top: 20px;
            cursor: pointer;
            font-size: 18px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #ff6b6b;
        }
        
        .btn:active {
            border-style: inset;
        }
        
        #gameOverScreen {
            display: none;
        }
        
        h1 {
            font-size: 42px;
            margin-bottom: 10px;
            color: #e74c3c;
            position: relative;
            padding: 10px;
            animation: colorCycle 4s infinite;
            text-transform: uppercase;
        }
        
        @keyframes colorCycle {
            0% { color: #e74c3c; }
            25% { color: #f1c40f; }
            50% { color: #2ecc71; }
            75% { color: #3498db; }
            100% { color: #e74c3c; }
        }
        
        p {
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
            padding: 0 20px;
            color: #ddd;
            max-width: 80%;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameInfo">
            Level: <span id="levelDisplay">1</span> | Lives: <span id="livesDisplay">3</span>
        </div>
        
        <canvas id="gameCanvas"></canvas>
        
        <div id="mobileControls">
            <div class="mobileBtn" id="leftBtn">←</div>
            <div class="mobileBtn" id="upBtn">↑</div>
            <div class="mobileBtn" id="downBtn">↓</div>
            <div class="mobileBtn" id="rightBtn">→</div>
        </div>
        
        <div id="startScreen">
            <div class="presents">VINCENZO SALVIA PRESENTS</div>
            <h1 class="retro-text">Pizza Crossing</h1>
            <p>Help our hero cross the road with his pizza without getting hit!</p>
            <p>Use arrow keys on desktop or touch buttons on mobile to move.</p>
            <button class="btn" id="startBtn">Start Game</button>
        </div>
        
        <div id="gameOverScreen">
            <h1 class="retro-text">Game Over</h1>
            <p>Oh no! The pizza fell on the ground...</p>
            <p>You reached level: <span id="finalLevel">1</span></p>
            <button class="btn" id="restartBtn">Try Again</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variabili di gioco
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const levelDisplay = document.getElementById('levelDisplay');
            const livesDisplay = document.getElementById('livesDisplay');
            const finalLevelDisplay = document.getElementById('finalLevel');
            const startScreen = document.getElementById('startScreen');
            const gameOverScreen = document.getElementById('gameOverScreen');
            const startBtn = document.getElementById('startBtn');
            const restartBtn = document.getElementById('restartBtn');
        
        // Dimensioni del canvas
        canvas.width = 600;
        canvas.height = 800;
        
        // Constanti di gioco
        const ROAD_HEIGHT = 80;
        const SIDEWALK_HEIGHT = 100;
        const PLAYER_SIZE = 40;
        const CAR_WIDTH = 80;
        const CAR_HEIGHT = 40;
        
        // Stato di gioco
        let gameActive = false;
        let level = 1;
        let lives = 3;
        let playerX = canvas.width / 2 - PLAYER_SIZE / 2;
        let playerY = canvas.height - SIDEWALK_HEIGHT - PLAYER_SIZE / 2;
        let cars = [];
        let lastTime = 0;
        let crashed = false;
        let crashTime = 0;
        let pizzaX = 0;
        let pizzaY = 0;
        let sauceParticles = [];
        let homeY = SIDEWALK_HEIGHT / 2;
        
        // Colori
        const colors = {
            road: '#555',
            sidewalk: '#aaa',
            player: '#e74c3c',
            playerLeg: '#3498db',
            pizzaBox: '#ffffff',
            sauce: '#c0392b',
            car: ['#2ecc71', '#3498db', '#9b59b6', '#f1c40f', '#e67e22']
        };
        
        // Controlli
        const keys = {
            ArrowUp: false,
            ArrowDown: false,
            ArrowLeft: false,
            ArrowRight: false
        };
        
        // Impostazioni iniziali
        function resetGame() {
            level = 1;
            lives = 5; // Aumentiamo le vite da 3 a 5 per rendere il gioco più facile
            levelDisplay.textContent = level;
            livesDisplay.textContent = lives;
            playerX = canvas.width / 2 - PLAYER_SIZE / 2;
            playerY = canvas.height - SIDEWALK_HEIGHT - PLAYER_SIZE / 2;
            cars = [];
            crashed = false;
            sauceParticles = [];
            generateCars();
        }
        
        // Generazione delle macchine
        function generateCars() {
            cars = [];
            const numRoads = Math.floor((canvas.height - 2 * SIDEWALK_HEIGHT) / ROAD_HEIGHT);
            
            for (let i = 0; i < numRoads; i++) {
                const roadY = SIDEWALK_HEIGHT + i * ROAD_HEIGHT;
                // Ridurre il numero di auto per rendere il gioco più facile
                const numCars = Math.min(1 + Math.floor(level / 3), 4);
                const direction = i % 2 === 0 ? 1 : -1;
                // Ridurre la velocità delle auto per rendere il gioco più facile
                const speed = (1 + Math.min(level * 0.3, 3)) * direction;
                
                for (let j = 0; j < numCars; j++) {
                    const carSpacing = canvas.width / numCars;
                    // Aggiungere un offset casuale per variare la posizione delle auto
                    const randomOffset = Math.random() * 0.5 * carSpacing;
                    let carX;
                    
                    if (direction === 1) {
                        carX = j * carSpacing - CAR_WIDTH + randomOffset;
                    } else {
                        carX = canvas.width - j * carSpacing - randomOffset;
                    }
                    
                    cars.push({
                        x: carX,
                        y: roadY + ROAD_HEIGHT / 2 - CAR_HEIGHT / 2,
                        width: CAR_WIDTH,
                        height: CAR_HEIGHT,
                        speed: speed,
                        color: colors.car[Math.floor(Math.random() * colors.car.length)]
                    });
                }
            }
        }
        
        // Aggiornamento del gioco
        function update(time) {
            if (!lastTime) {
                lastTime = time;
            }
            const deltaTime = (time - lastTime) / 1000;
            lastTime = time;
            
            if (!gameActive) {
                requestAnimationFrame(update);
                return;
            }
            
            if (!crashed) {
                // Movimento del giocatore
                const moveSpeed = 200;
                if (keys.ArrowUp && playerY > SIDEWALK_HEIGHT) {
                    playerY -= moveSpeed * deltaTime;
                }
                if (keys.ArrowDown && playerY < canvas.height - SIDEWALK_HEIGHT - PLAYER_SIZE) {
                    playerY += moveSpeed * deltaTime;
                }
                if (keys.ArrowLeft && playerX > 0) {
                    playerX -= moveSpeed * deltaTime;
                }
                if (keys.ArrowRight && playerX < canvas.width - PLAYER_SIZE) {
                    playerX += moveSpeed * deltaTime;
                }
                
                // Aggiornamento delle macchine
                cars.forEach(car => {
                    car.x += car.speed * deltaTime * 60;
                    
                    // Riposizionamento delle macchine che escono dallo schermo
                    if (car.speed > 0 && car.x > canvas.width) {
                        car.x = -car.width;
                    } else if (car.speed < 0 && car.x < -car.width) {
                        car.x = canvas.width;
                    }
                    
                    // Rilevamento collisioni
                    if (!crashed &&
                        playerX < car.x + car.width &&
                        playerX + PLAYER_SIZE > car.x &&
                        playerY < car.y + car.height &&
                        playerY + PLAYER_SIZE > car.y) {
                        crashed = true;
                        crashTime = time;
                        pizzaX = playerX;
                        pizzaY = playerY - 10;
                        
                        // Creazione delle particelle di sugo
                        for (let i = 0; i < 20; i++) {
                            sauceParticles.push({
                                x: pizzaX + PLAYER_SIZE / 2,
                                y: pizzaY + PLAYER_SIZE / 2,
                                vx: (Math.random() - 0.5) * 5,
                                vy: (Math.random() - 0.5) * 5,
                                size: Math.random() * 8 + 2
                            });
                        }
                        
                        lives--;
                        livesDisplay.textContent = lives;
                        
                        if (lives <= 0) {
                            setTimeout(() => {
                                gameActive = false;
                                finalLevelDisplay.textContent = level;
                                gameOverScreen.style.display = 'flex';
                            }, 2000);
                        } else {
                            // Riavvio dopo l'incidente
                            setTimeout(() => {
                                crashed = false;
                                playerX = canvas.width / 2 - PLAYER_SIZE / 2;
                                playerY = canvas.height - SIDEWALK_HEIGHT - PLAYER_SIZE / 2;
                                sauceParticles = [];
                            }, 2000);
                        }
                    }
                });
                
                // Verifica vittoria livello
                if (playerY <= SIDEWALK_HEIGHT) {
                    level++;
                    levelDisplay.textContent = level;
                    playerX = canvas.width / 2 - PLAYER_SIZE / 2;
                    playerY = canvas.height - SIDEWALK_HEIGHT - PLAYER_SIZE / 2;
                    generateCars();
                }
            } else {
                // Aggiornamento animazione incidente
                sauceParticles.forEach(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.size *= 0.99;
                });
            }
            
            draw();
            requestAnimationFrame(update);
        }
        
        // Disegno del gioco
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Disegno strada e marciapiedi
            ctx.fillStyle = colors.sidewalk;
            ctx.fillRect(0, 0, canvas.width, SIDEWALK_HEIGHT);
            ctx.fillRect(0, canvas.height - SIDEWALK_HEIGHT, canvas.width, SIDEWALK_HEIGHT);
            
            // Disegno casa
            drawHome();
            
            // Disegno strade
            const numRoads = Math.floor((canvas.height - 2 * SIDEWALK_HEIGHT) / ROAD_HEIGHT);
            ctx.fillStyle = colors.road;
            
            for (let i = 0; i < numRoads; i++) {
                const roadY = SIDEWALK_HEIGHT + i * ROAD_HEIGHT;
                ctx.fillRect(0, roadY, canvas.width, ROAD_HEIGHT);
                
                // Linee di mezzeria
                ctx.strokeStyle = 'white';
                ctx.setLineDash([20, 10]);
                ctx.beginPath();
                ctx.moveTo(0, roadY + ROAD_HEIGHT / 2);
                ctx.lineTo(canvas.width, roadY + ROAD_HEIGHT / 2);
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // Disegno macchine (stile low poly)
            cars.forEach(car => {
                drawCar(car);
            });
            
            // Disegno giocatore
            if (!crashed) {
                drawPlayer(playerX, playerY);
            } else {
                // Animazione caduta
                drawFallenPlayer(playerX, playerY);
                
                // Disegno cartone pizza caduto
                ctx.fillStyle = colors.pizzaBox;
                ctx.fillRect(pizzaX, pizzaY, 25, 25);
                // Aggiunta di un po' di dettaglio al cartone
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 1;
                ctx.strokeRect(pizzaX, pizzaY, 25, 25);
                // Linea del logo sulla scatola
                ctx.strokeStyle = '#e74c3c';
                ctx.beginPath();
                ctx.moveTo(pizzaX + 5, pizzaY + 12);
                ctx.lineTo(pizzaX + 20, pizzaY + 12);
                ctx.stroke();
                
                // Disegno particelle sugo
                ctx.fillStyle = colors.sauce;
                sauceParticles.forEach(particle => {
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                });
            }
        }
        
        // Disegno casa (destinazione)
        function drawHome() {
            // Disegno casa low poly
            ctx.fillStyle = '#e74c3c'; // Tetto
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2 - 40, homeY - 15);
            ctx.lineTo(canvas.width / 2 + 40, homeY - 15);
            ctx.lineTo(canvas.width / 2, homeY - 40);
            ctx.closePath();
            ctx.fill();
            
            ctx.fillStyle = '#ecf0f1'; // Corpo casa
            ctx.fillRect(canvas.width / 2 - 30, homeY - 15, 60, 40);
            
            ctx.fillStyle = '#34495e'; // Porta
            ctx.fillRect(canvas.width / 2 - 10, homeY + 5, 20, 20);
            
            ctx.fillStyle = '#3498db'; // Finestra
            ctx.fillRect(canvas.width / 2 - 20, homeY - 5, 10, 10);
            ctx.fillRect(canvas.width / 2 + 10, homeY - 5, 10, 10);
        }
        
        // Disegno giocatore (stile low poly)
        function drawPlayer(x, y) {
            // Corpo
            ctx.fillStyle = '#3498db';
            ctx.beginPath();
            ctx.moveTo(x + PLAYER_SIZE/2, y);
            ctx.lineTo(x + PLAYER_SIZE, y + PLAYER_SIZE/2);
            ctx.lineTo(x + PLAYER_SIZE/2, y + PLAYER_SIZE);
            ctx.lineTo(x, y + PLAYER_SIZE/2);
            ctx.closePath();
            ctx.fill();
            
            // Testa
            ctx.fillStyle = '#e67e22';
            ctx.beginPath();
            ctx.arc(x + PLAYER_SIZE/2, y, PLAYER_SIZE/3, 0, Math.PI * 2);
            ctx.fill();
            
            // Cartone della pizza
            ctx.fillStyle = colors.pizzaBox;
            ctx.fillRect(x + PLAYER_SIZE - 5, y - 5, 30, 30);
            // Aggiunta di un po' di dettaglio al cartone
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            ctx.strokeRect(x + PLAYER_SIZE - 5, y - 5, 30, 30);
            // Linea del logo sulla scatola
            ctx.strokeStyle = '#e74c3c';
            ctx.beginPath();
            ctx.moveTo(x + PLAYER_SIZE, y + 10);
            ctx.lineTo(x + PLAYER_SIZE + 20, y + 10);
            ctx.stroke();
        }
        
        // Disegno giocatore caduto
        function drawFallenPlayer(x, y) {
            // Corpo
            ctx.fillStyle = '#3498db';
            ctx.beginPath();
            ctx.moveTo(x, y + PLAYER_SIZE/2);
            ctx.lineTo(x + PLAYER_SIZE/2, y);
            ctx.lineTo(x + PLAYER_SIZE, y + PLAYER_SIZE/2);
            ctx.lineTo(x + PLAYER_SIZE/2, y + PLAYER_SIZE);
            ctx.closePath();
            ctx.fill();
            
            // Testa (inclinata)
            ctx.fillStyle = '#e67e22';
            ctx.beginPath();
            ctx.arc(x + PLAYER_SIZE/4, y + PLAYER_SIZE/2, PLAYER_SIZE/3, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Disegno auto (stile low poly)
        function drawCar(car) {
            ctx.fillStyle = car.color;
            
            // Corpo auto
            ctx.beginPath();
            ctx.moveTo(car.x, car.y + car.height/2);
            ctx.lineTo(car.x + car.width * 0.2, car.y);
            ctx.lineTo(car.x + car.width * 0.8, car.y);
            ctx.lineTo(car.x + car.width, car.y + car.height/2);
            ctx.lineTo(car.x + car.width * 0.8, car.y + car.height);
            ctx.lineTo(car.x + car.width * 0.2, car.y + car.height);
            ctx.closePath();
            ctx.fill();
            
            // Finestrini
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.moveTo(car.x + car.width * 0.3, car.y + car.height * 0.2);
            ctx.lineTo(car.x + car.width * 0.7, car.y + car.height * 0.2);
            ctx.lineTo(car.x + car.width * 0.7, car.y + car.height * 0.5);
            ctx.lineTo(car.x + car.width * 0.3, car.y + car.height * 0.5);
            ctx.closePath();
            ctx.fill();
            
            // Ruote
            ctx.fillStyle = '#111';
            ctx.fillRect(car.x + car.width * 0.1, car.y + car.height, car.width * 0.2, car.height * 0.2);
            ctx.fillRect(car.x + car.width * 0.7, car.y + car.height, car.width * 0.2, car.height * 0.2);
        }
        
        // Gestione input tastiera
        window.addEventListener('keydown', e => {
            if (e.key in keys) {
                keys[e.key] = true;
                e.preventDefault();
            }
        });
        
        window.addEventListener('keyup', e => {
            if (e.key in keys) {
                keys[e.key] = false;
                e.preventDefault();
            }
        });
        
        // Controlli touch per mobile
        const upBtn = document.getElementById('upBtn');
        const downBtn = document.getElementById('downBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');
        
        upBtn.addEventListener('touchstart', () => { keys.ArrowUp = true; });
        upBtn.addEventListener('touchend', () => { keys.ArrowUp = false; });
        downBtn.addEventListener('touchstart', () => { keys.ArrowDown = true; });
        downBtn.addEventListener('touchend', () => { keys.ArrowDown = false; });
        leftBtn.addEventListener('touchstart', () => { keys.ArrowLeft = true; });
        leftBtn.addEventListener('touchend', () => { keys.ArrowLeft = false; });
        rightBtn.addEventListener('touchstart', () => { keys.ArrowRight = true; });
        rightBtn.addEventListener('touchend', () => { keys.ArrowRight = false; });
        
        // Per il supporto click su desktop
        upBtn.addEventListener('mousedown', () => { keys.ArrowUp = true; });
        upBtn.addEventListener('mouseup', () => { keys.ArrowUp = false; });
        downBtn.addEventListener('mousedown', () => { keys.ArrowDown = true; });
        downBtn.addEventListener('mouseup', () => { keys.ArrowDown = false; });
        leftBtn.addEventListener('mousedown', () => { keys.ArrowLeft = true; });
        leftBtn.addEventListener('mouseup', () => { keys.ArrowLeft = false; });
        rightBtn.addEventListener('mousedown', () => { keys.ArrowRight = true; });
        rightBtn.addEventListener('mouseup', () => { keys.ArrowRight = false; });
        
        // Redimensionamento canvas 
        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            const maxWidth = Math.min(window.innerWidth - 20, 600);
            container.style.width = maxWidth + 'px';
            
            // Proporzioni del canvas
            const aspectRatio = canvas.height / canvas.width;
            canvas.style.height = (maxWidth * aspectRatio) + 'px';
        }
        
        window.addEventListener('resize', resizeCanvas);
        
        // Pulsanti di controllo del gioco
        startBtn.addEventListener('click', () => {
            startScreen.style.display = 'none';
            resetGame();
            gameActive = true;
        });
        
        restartBtn.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            resetGame();
            gameActive = true;
        });
        
        // Inizializzazione
        resizeCanvas();
        resetGame();
        requestAnimationFrame(update);
        
        });
    </script>
</body>
</html>